{% extends 'base.html' %}
{% load static %}

{% block title %}Home - CharmAway{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/home.css' %}?v=202501231730">

<!-- Hero Carousel Section -->
<section class="hero-carousel slide-1">
    <div class="carousel-container">
        <div class="carousel-track">
            <div class="carousel-slide active">
                <div class="slide-content">
                    <div class="slide-text">
                        <h1>Descubre tu belleza natural</h1>
                        <p>Los mejores productos de cosmética para ti</p>
                        <a href="{% url 'catalog:catalog' %}" class="btn-primary">Explorar Catálogo</a>
                    </div>
                    <div class="slide-image">
                        <div class="image-gradient-container">
                            {% if featured_products %}
                            <img src="{{ featured_products.0.images.all.0.image }}" alt="{{ featured_products.0.name }}" class="hero-product-image" onerror="this.style.display='none';">
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</section>

<!-- Departments Section -->
<section class="categories-section">
    <div class="container">
        <h2 class="section-title">Explora por departamento</h2>
        <div class="categories-carousel-wrapper">
            <div class="categories-carousel" id="categoriesCarousel">
                {% for department in departments %}
                <a href="{% if department.name == 'Servicios' %}{% url 'services:services_catalog' %}{% else %}{% url 'catalog:catalog' %}?department={{ department.id }}{% endif %}" class="category-card">
                    <div class="category-icon">
                        {% if department.image %}
                        <img src="{{ department.image }}" alt="{{ department.name }}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        {% endif %}
                        <div class="category-placeholder" {% if department.image %}style="display:none;"{% endif %}>
                            <svg width="60" height="60" viewBox="0 0 24 24" fill="none">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5"/>
                                <path d="M12 8v8M8 12h8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                        </div>
                    </div>
                    <h3>{{ department.name }}</h3>
                </a>
                {% empty %}
                <p class="no-content">No hay departamentos disponibles.</p>
                {% endfor %}
            </div>
        </div>
    </div>
</section>

<!-- Featured Products Section -->
{% if featured_products %}
<section class="featured-section">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Productos destacados</h2>
            <a href="{% url 'catalog:catalog' %}" class="view-all">Ver todos</a>
        </div>
        <div class="products-grid">
            {% for product in featured_products %}
            <article class="product-card">
                <a href="{% url 'catalog:product_detail' product.id %}" class="product-link">
                    <div class="product-image-wrapper">
                        {% with main_image=product.images.all|first %}
                        {% if main_image %}
                        <img src="{{ main_image.image }}" alt="{{ product.name }}" class="product-image"
                             onerror="this.onerror=null; this.src='{% static 'images/no-image.svg' %}'; this.style.objectFit='contain'; this.style.padding='2rem';">
                        {% else %}
                        <img src="{% static 'images/no-image.svg' %}" alt="Sin imagen" class="product-image"
                             style="object-fit: contain; padding: 2rem;">
                        {% endif %}
                        {% endwith %}
                    </div>

                    <div class="product-info">
                        {% if product.brand %}
                        <p class="product-brand">{{ product.brand.name }}</p>
                        {% endif %}

                        <h3 class="product-name">{{ product.name }}</h3>

                        {% if product.category %}
                        <p class="product-category">{{ product.category.name }}</p>
                        {% endif %}

                        <div class="product-pricing">
                            {% if product.offer_price %}
                            <span class="product-price original-price">{{ product.price }} €</span>
                            <span class="product-price offer-price">{{ product.offer_price }} €</span>
                            {% else %}
                            <span class="product-price">{{ product.price }} €</span>
                            {% endif %}
                        </div>

                        {% if product.stock > 0 %}
                        <p class="product-stock in-stock">En stock</p>
                        {% else %}
                        <p class="product-stock out-of-stock">Agotado</p>
                        {% endif %}
                    </div>
                </a>

                <a href="{% url 'buy_now_product' product.id %}"
                    onmouseover="this.style.background='#005bbd'"
                    onmouseout="this.style.background='#0070f3'"
                    {% if product.stock <= 0 %} disabled style="display:flex;align-items:center;margin-top:0.5rem;margin-bottom:0.5rem;margin-left:0.rem;background:#2a84ea;color:#fff;padding:0.3rem 1rem;width:8rem;border-radius:6px;font-weight:600;font-size:12px;transition: background 0.2s ease;text-decoration:none;justify-content:center;opacity:0.5; cursor:not-allowed;" {% else %} style="display:flex;align-items:center;margin-top:0.5rem;margin-bottom:0.5rem;background:#2a84ea;color:#fff;padding:0.3rem 1rem;width:8rem;border-radius:6px;font-weight:600;font-size:12px;transition: background 0.2s ease;text-decoration:none;justify-content:center;"{% endif %}>
                    Compra rápida
                </a>

                <form action="{% url 'add_product' product.id %}" 
                    onclick="setTimeout(() => location.reload(), 50);" 
                    method="post">
                    {% csrf_token %}
                    <button type="submit" 
                            class="btn-add-cart"
                            {% if product.stock <= 0 %}disabled style="opacity:0.5; cursor:not-allowed;"{% endif %}>
                        Añadir al carro
                    </button>
                </form>
            </article>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}
{% endblock %}